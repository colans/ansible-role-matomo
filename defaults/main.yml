---
# defaults file for ansible-role-matomo

# Architecture
matomo_max_int: "{{ (ansible_userspace_bits == '64') | ternary('9223372036854775807', '2147483647') }}"

# General
matomo_domain: "matomo.example.com"
matomo_protocol: "https"
matomo_url: "{{ matomo_protocol }}://{{ matomo_domain }}/"
matomo_timezone: "America/Toronto"
matomo_https_certificate_email: "tech@example.com"

## Paths
matomo_path:
  docroot: "/usr/share/matomo"
  config: "/etc/matomo"
  temporary: "/tmp"

# Web configuration
matomo_web_config_dir_main: "/etc/nginx"
matomo_web_config_dir:
  available: "{{ matomo_web_config_dir_main }}/sites-available"
  enabled: "{{ matomo_web_config_dir_main }}/sites-enabled"
matomo_web_config_file:
  regular: "{{ matomo_web_config_dir['available'] }}/matomo.conf"
  link: "{{ matomo_web_config_dir['enabled'] }}/matomo.conf"
matomo_web_config_phpfpm_mode: "port" # or "socket"

# Database
matomo_db:
  host: "127.0.0.1"
  name: "matomo"
  user: "matomo"
  table_prefix: ""

# Salts
matomo_salt: "{{ lookup('vars', 'matomo_max_int') | random | to_uuid | hash('bcrypt') }}"
matomo_useridsalt: "{{ lookup('password', '/dev/null length=40') }}"

# Hosted site
matomo_hosted_site_domain: "example.com"
matomo_hosted_site_protocol: "https"
matomo_hosted_site:
  name: "Example"
  url: "{{ matomo_hosted_site_protocol }}://{{ matomo_hosted_site_domain }}/"
  timezone: "{{ matomo_timezone }}"
  ecommerce: 0
  currency: "USD"

# Superuser
matomo_superuser:
  name: "admin"
  password: "{{ lookup('password', '/dev/null length=20 chars=ascii_letters') }}"
  email: "operations@example.com"
matomo_superuser_alias: "{{ matomo_superuser['name'] }}"
# As per https://github.com/matomo-org/matomo/blob/3.x-dev/plugins/UsersManager/API.php#L1317
matomo_superuser_token_auth: "{{ matomo_superuser.name ~ ansible_date_time.iso8601_micro ~ matomo_superuser.password ~ matomo_salt | hash('bcrypt') }}"
